{"pageProps":{"postData":{"id":"mysql_isolation","contentHtml":"<p>测试数据</p>\n<pre><code class=\"hljs language-nsql\"><span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> IF <span class=\"hljs-keyword\">EXISTS</span> IsolationTests;\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> IsolationTests\n(\n    Col1 <span class=\"hljs-type\">INT</span>,\n    Col2 <span class=\"hljs-type\">INT</span>,\n    Col3 <span class=\"hljs-type\">INT</span>\n);\n\n<span class=\"hljs-keyword\">INSERT</span> <span class=\"hljs-keyword\">INTO</span> IsolationTests(Col1,Col2,Col3)\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>\n<span class=\"hljs-keyword\">UNION</span> <span class=\"hljs-keyword\">ALL</span> <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>\n<span class=\"hljs-keyword\">UNION</span> <span class=\"hljs-keyword\">ALL</span> <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>\n<span class=\"hljs-keyword\">UNION</span> <span class=\"hljs-keyword\">ALL</span> <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>\n<span class=\"hljs-keyword\">UNION</span> <span class=\"hljs-keyword\">ALL</span> <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>\n<span class=\"hljs-keyword\">UNION</span> <span class=\"hljs-keyword\">ALL</span> <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>\n<span class=\"hljs-keyword\">UNION</span> <span class=\"hljs-keyword\">ALL</span> <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>;\n</code></pre>\n<h2>读未提交(READ UNCOMMITTED)</h2>\n<pre><code class=\"hljs language-nsql\"><span class=\"hljs-comment\">-- T1                                              - T2</span>\n<span class=\"hljs-keyword\">SET</span> TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;  <span class=\"hljs-keyword\">SET</span> TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;\n<span class=\"hljs-keyword\">BEGIN</span>;                                             <span class=\"hljs-keyword\">BEGIN</span>;\n<span class=\"hljs-keyword\">UPDATE</span> IsolationTests <span class=\"hljs-keyword\">SET</span> Col1 <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">2</span>;                \n                                                   <span class=\"hljs-comment\">-- Col1=2, dirty read </span>\n                                                   <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> IsolationTests;    \n<span class=\"hljs-keyword\">ROLLBACK</span>;                                          \n                                                   <span class=\"hljs-comment\">-- Col1=1</span>\n                                                   <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> IsolationTests;  \n                                                   <span class=\"hljs-keyword\">COMMIT</span>; \n</code></pre>\n<h2>读已提交(READ COMMITTED)</h2>\n<pre><code class=\"hljs language-nsql\"><span class=\"hljs-comment\">-- T1                                             -- T2                                            </span>\n<span class=\"hljs-keyword\">SET</span> TRANSACTION ISOLATION LEVEL READ COMMITTED;   <span class=\"hljs-keyword\">SET</span> TRANSACTION ISOLATION LEVEL READ COMMITTED;  \n<span class=\"hljs-keyword\">BEGIN</span>;                                            <span class=\"hljs-keyword\">BEGIN</span>;                                           \n                                                  <span class=\"hljs-comment\">-- Col1 = 1                   </span>\n                                                  <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> IsolationTests;    \n<span class=\"hljs-keyword\">UPDATE</span> IsolationTests <span class=\"hljs-keyword\">SET</span> Col1 <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">2</span>;               \n                                                  <span class=\"hljs-comment\">-- Col1 = 1, T1 uncommitted </span>\n                                                  <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> IsolationTests;    \n<span class=\"hljs-keyword\">COMMIT</span>;\n                                                  <span class=\"hljs-comment\">-- Col1 = 2, T1 committed </span>\n                                                  <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> IsolationTests;    \n\t\t\t\t\t\t\t\t\t\t\t\t  <span class=\"hljs-keyword\">COMMIT</span>;                                          \n</code></pre>\n<h2>可重复读(REPEATABLE READ)</h2>\n<pre><code class=\"hljs language-nsql\"><span class=\"hljs-comment\">-- T1                                             -- T2                                            </span>\n<span class=\"hljs-keyword\">SET</span> TRANSACTION ISOLATION LEVEL REPEATABLE READ;  <span class=\"hljs-keyword\">SET</span> TRANSACTION ISOLATION LEVEL REPEATABLE READ;  \n<span class=\"hljs-keyword\">BEGIN</span>;                                            <span class=\"hljs-keyword\">BEGIN</span>;                                           \n                                                  <span class=\"hljs-comment\">-- Col1 = 1                   </span>\n                                                  <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> IsolationTests;    \n<span class=\"hljs-keyword\">UPDATE</span> IsolationTests <span class=\"hljs-keyword\">SET</span> Col1 <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">2</span>;               \n                                                  <span class=\"hljs-comment\">-- Col1 = 1, T1 uncommitted</span>\n                                                  <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> IsolationTests;    \n<span class=\"hljs-keyword\">COMMIT</span>;\n                                                  <span class=\"hljs-comment\">-- Col1 = 1, T1 committed</span>\n                                                  <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> IsolationTests;    \n                                                  <span class=\"hljs-keyword\">COMMIT</span>;\n</code></pre>\n<h2>幻读(REPEATABLE READ)</h2>\n<pre><code class=\"hljs language-nsql\"><span class=\"hljs-comment\">-- T1                                              -- T2                                            </span>\n<span class=\"hljs-keyword\">SET</span> TRANSACTION ISOLATION LEVEL REPEATABLE READ ;  <span class=\"hljs-keyword\">SET</span> TRANSACTION ISOLATION LEVEL REPEATABLE READ ;\n<span class=\"hljs-keyword\">BEGIN</span>;                                             <span class=\"hljs-keyword\">BEGIN</span>;                                           \n                                                   <span class=\"hljs-comment\">-- empty </span>\n                                                   <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> IsolationTests <span class=\"hljs-keyword\">where</span> Col1<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span>;  \n<span class=\"hljs-keyword\">INSERT</span> <span class=\"hljs-keyword\">INTO</span> IsolationTests <span class=\"hljs-keyword\">values</span> (<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>);                                 \n<span class=\"hljs-keyword\">COMMIT</span>;                                            \n                                                   <span class=\"hljs-comment\">-- empty      </span>\n                                                   <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> IsolationTests <span class=\"hljs-keyword\">where</span> Col1<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span>;   \n                                                   <span class=\"hljs-comment\">-- Update with forced latest snapshot </span>\n                                                   <span class=\"hljs-keyword\">UPDATE</span> IsolationTests <span class=\"hljs-keyword\">SET</span> Col2<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">3</span>, Col3<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">4</span> <span class=\"hljs-keyword\">where</span> Col1<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span>;\n                                                   <span class=\"hljs-comment\">-- Phantom Read : Col (2, 3, 4)</span>\n                                                   <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> IsolationTests <span class=\"hljs-keyword\">where</span> Col1<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span>;\n                                                   <span class=\"hljs-keyword\">COMMIT</span>; \n</code></pre>\n<blockquote>\n<ul>\n<li><a href=\"https://dev.mysql.com/doc/refman/5.7/en/innodb-consistent-read.html\">innodb-consistent-read</a></li>\n<li><a href=\"https://gavindraper.com/2012/02/18/sql-server-isolation-levels-by-example/\">sql-server-isolation-levels-by-example</a></li>\n</ul>\n</blockquote>\n","title":"Mysql事务隔离级别(无废话版)","date":"2023-12-18","description":"Mysql事务隔离级别(无废话版)"}},"__N_SSG":true}