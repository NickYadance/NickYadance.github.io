{"pageProps":{"postData":{"id":"understand_the_kubernetes_network","contentHtml":"<h2>单机上的两个Pod如何通信</h2>\n<p><img src=\"/images/understand_the_kubernetes_network/network_in_node.png\" alt=\"network_in_node.png\"></p>\n<ul>\n<li>Pod通过<strong>network namespace</strong>与主机网络隔离</li>\n<li>Pod中存在一个虚拟以太网设备对(veth pair)，一端(eth0)在Pod的network namespace中，另一端(ethxx)在主机网络中</li>\n<li>Host的多个veth通过bridge网络相连，所以单机Pod间的通信本质上是多个虚拟设备构成的桥接网络</li>\n</ul>\n<h2>多机上的两个Pod如何通信</h2>\n<p><img src=\"/images/understand_the_kubernetes_network/network_cross_node.png\" alt=\"network_cross_node.png\"></p>\n<ul>\n<li>多机场景下，需要将不同主机网络相连</li>\n</ul>\n<h2>Service 的原理</h2>\n<p><img src=\"/images/understand_the_kubernetes_network/services.png\" alt=\"services.png\"></p>\n<ul>\n<li>services本身与网络拓扑没有关系</li>\n<li>services包括一个虚拟的ip地址</li>\n<li>kube-proxy(one per node)根据services的定义修改iptables规则，将发往services ip的包，路由到对应的pod地址</li>\n</ul>\n<h2>Ingress 的原理</h2>\n<p><img src=\"/images/understand_the_kubernetes_network/ingress.png\" alt=\"img.png\"></p>\n<ul>\n<li>与<code>LoadBalancer</code>不同，Ingress只需要一个独立Ip地址，可以路由到多个Service</li>\n<li>Ingress需要一个配套的<code>IngressController</code>，来完成实际的流量分配</li>\n<li>IngressController需要将自身端口暴露到集群外部以供访问，可能是通过<code>NodePort</code></li>\n</ul>\n<h2>什么是Linux namespace</h2>\n<p>Linux namespace是内核提供的功能，是Linux容器化技术的基石，可以通过<a href=\"https://man7.org/linux/man-pages/man1/unshare.1.html\">unshare</a>命令调用。\n<img src=\"https://i0.wp.com/theboreddev.com/wp-content/uploads/2023/02/linux-container.png?w=451&amp;ssl=1\" alt=\"container\"></p>\n<h2>什么是虚拟以太网设备(veth)</h2>\n<p>linux虚拟以太网设备是<a href=\"https://oldwiki.archive.openwrt.org/doc/networking/network.interfaces\">network interface</a>的一种，可以在没有物理设备的情况下，对网络进行逻辑分区。</p>\n<blockquote>\n<ul>\n<li><a href=\"https://www.manning.com/books/kubernetes-in-action\">kubernetes-in-action</a></li>\n</ul>\n</blockquote>\n","title":"理解k8s网络","date":"2023-12-18","description":"理解k8s网络的工作原理"}},"__N_SSG":true}