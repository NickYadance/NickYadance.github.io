# 私人博客设计方案

## 一、设计目标

1. **Doc as Code**: 博客内容以 Markdown 文件形式存储在代码仓库中
2. **零依赖生成**: 从 Markdown 文件直接生成可部署的静态前端代码，尽量不依赖第三方框架
3. **简单高效**: 构建过程简单，生成的前端代码轻量、可独立部署

## 二、整体架构

### 2.1 核心思想

采用**静态站点生成（SSG）**模式：
- 构建时：读取 Markdown 文件 → 解析内容 → 生成静态 HTML/CSS/JS
- 运行时：纯静态文件，无需服务器端渲染，可直接部署到 GitHub Pages、Vercel 等平台

### 2.2 架构分层

```
┌─────────────────────────────────────┐
│   Markdown 源文件 (posts/)          │
│   - 文章内容                        │
│   - Frontmatter 元数据              │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│   构建工具 (Go 实现)                │
│   - Markdown 解析器                 │
│   - 模板引擎                        │
│   - 静态资源处理                    │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│   生成的静态站点 (dist/)            │
│   - HTML 文件                       │
│   - CSS 样式                        │
│   - JavaScript (可选，最小化)       │
│   - 图片等静态资源                  │
└─────────────────────────────────────┘
```

## 三、功能设计

### 3.1 Markdown 文件规范

**Frontmatter 格式**（YAML）：
- `title`: 文章标题
- `date`: 发布日期（YYYY-MM-DD）
- `description`: 文章摘要
- `tags`: 标签列表（可选）
- `category`: 分类（可选）

**内容支持**：
- 标准 Markdown 语法
- 数学公式（LaTeX，使用 KaTeX 客户端渲染）
- 代码高亮（使用 highlight.js 或 Prism.js）
- 图片引用（相对路径，自动处理）

### 3.2 生成的文件结构

```
dist/
├── index.html              # 首页（文章列表）
├── posts/
│   ├── binarysearch.html   # 单篇文章页面
│   ├── boltdb.html
│   └── ...
├── assets/
│   ├── css/
│   │   └── style.css       # 统一样式文件
│   ├── js/
│   │   └── main.js         # 最小化 JS（代码高亮、数学公式）
│   └── images/             # 图片资源
└── robots.txt
```

### 3.3 页面类型

#### 3.3.1 首页（文章列表）
- 显示所有文章，按日期倒序排列
- 每篇文章显示：标题、日期、摘要、标签
- 支持分页（可选）
- 支持搜索（客户端 JavaScript，可选）

#### 3.3.2 文章详情页
- 文章标题和元信息
- 文章正文（Markdown 渲染后的 HTML）
- 代码高亮
- 数学公式渲染
- 上一篇/下一篇导航
- 返回列表链接

#### 3.3.3 分类/标签页（可选）
- 按分类或标签聚合文章
- 标签云展示

## 四、技术实现方案

### 4.1 构建工具选择

**推荐：Go 语言实现**
- 优势：
  - 单一可执行文件，无需依赖管理
  - 编译速度快
  - 标准库强大（html/template, text/template）
  - 跨平台支持好

**备选：Python**
- 使用标准库 + markdown 库
- 但需要 Python 环境

### 4.2 Markdown 解析

**方案一：纯 Go 实现**
- 使用 `github.com/yuin/goldmark` 或类似库
- 支持扩展：代码高亮、数学公式识别

**方案二：调用外部工具**
- 使用 `pandoc` 或 `marked`（但增加依赖）

**推荐方案一**，保持零外部依赖。

### 4.3 模板系统

使用 Go 的 `html/template` 包：
- 定义 HTML 模板文件
- 支持模板继承/嵌套
- 数据注入：文章列表、单篇文章、元数据等

### 4.4 样式方案

**CSS 生成策略**：
- 预定义一套简洁的 CSS 样式
- 通过模板注入到每个 HTML 文件
- 或生成独立的 CSS 文件，所有页面引用

**设计原则**：
- 响应式设计（移动端友好）
- 代码高亮样式
- 数学公式样式
- 打印友好

### 4.5 JavaScript 最小化

**仅包含必要的客户端功能**：
- 代码高亮初始化（highlight.js 或 Prism.js，CDN 引入）
- 数学公式渲染（KaTeX，CDN 引入）
- 暗色模式切换（可选）
- 目录导航（可选）

**不依赖框架**：使用原生 JavaScript，或最小化的工具库。

### 4.6 静态资源处理

**图片处理**：
- 扫描 Markdown 中的图片引用
- 从 `posts/` 或 `public/images/` 复制到 `dist/assets/images/`
- 更新 HTML 中的图片路径

**其他资源**：
- favicon、robots.txt 等从 `public/` 复制到 `dist/`

## 五、构建流程

### 5.1 构建步骤

1. **扫描阶段**
   - 遍历 `posts/` 目录，找到所有 `.md` 文件
   - 解析每个文件的 frontmatter 和内容

2. **解析阶段**
   - 将 Markdown 转换为 HTML
   - 提取代码块，准备高亮
   - 识别数学公式，准备渲染

3. **生成阶段**
   - 生成首页 HTML（文章列表）
   - 为每篇文章生成独立的 HTML 文件
   - 生成分类/标签页（如果启用）

4. **资源处理阶段**
   - 复制图片到输出目录
   - 生成统一的 CSS 文件
   - 生成最小化的 JS 文件（或使用 CDN）

5. **优化阶段**（可选）
   - HTML 压缩
   - CSS 压缩
   - 图片优化

### 5.2 构建命令

```bash
# 开发模式：监听文件变化，自动重建
./blog build --watch

# 生产模式：生成优化后的静态文件
./blog build --prod

# 本地预览：启动简单 HTTP 服务器
./blog serve
```

## 六、部署方案

### 6.1 部署目标

- **GitHub Pages**: 将 `dist/` 目录推送到 `gh-pages` 分支
- **Vercel/Netlify**: 连接仓库，自动构建部署
- **自托管**: 将 `dist/` 目录上传到任何静态文件服务器

### 6.2 CI/CD 集成

**GitHub Actions 工作流**：
1. 监听 `posts/` 目录的变更
2. 自动运行构建命令
3. 生成静态文件
4. 部署到 GitHub Pages

## 七、目录结构

```
项目根目录/
├── posts/                 # Markdown 源文件
│   ├── binarysearch.md
│   ├── boltdb.md
│   └── images/           # 文章相关图片
├── vaults/               # 个人文档（保留）
├── templates/            # HTML 模板
│   ├── base.html        # 基础模板
│   ├── index.html       # 首页模板
│   └── post.html        # 文章页模板
├── assets/              # 静态资源源文件
│   ├── css/
│   │   └── style.css
│   └── js/
│       └── main.js
├── public/              # 公共资源
│   ├── favicon.ico
│   └── robots.txt
├── dist/                # 构建输出目录（.gitignore）
├── blog                 # 构建工具可执行文件
├── go.mod
├── go.sum
└── README.md
```

## 八、扩展功能（可选）

### 8.1 RSS 订阅
- 生成 `feed.xml` 文件
- 包含最新文章列表和摘要

### 8.2 站点地图
- 生成 `sitemap.xml`
- 便于搜索引擎索引

### 8.3 搜索功能
- 客户端搜索：生成文章索引 JSON，前端 JavaScript 搜索
- 或集成 Algolia 等第三方搜索服务

### 8.4 评论系统
- 集成 Giscus（基于 GitHub Discussions）
- 或使用其他第三方评论服务

### 8.5 访问统计
- 集成 Google Analytics 或 Plausible
- 通过模板注入统计代码

## 九、优势总结

1. **零运行时依赖**：生成纯静态文件，部署简单
2. **版本控制友好**：内容即代码，Git 管理方便
3. **性能优秀**：静态文件加载快，CDN 友好
4. **成本低**：可免费部署到 GitHub Pages
5. **可定制性强**：完全控制生成过程和样式
6. **维护简单**：构建工具单一可执行文件，无需复杂依赖管理

## 十、实施建议

### 阶段一：核心功能
1. 实现 Markdown 解析和 HTML 生成
2. 实现基础模板系统
3. 生成首页和文章详情页

### 阶段二：样式和体验
1. 设计并实现 CSS 样式
2. 集成代码高亮和数学公式
3. 优化移动端体验

### 阶段三：增强功能
1. 添加分类/标签功能
2. 实现搜索功能
3. 生成 RSS 和站点地图

### 阶段四：优化和部署
1. 性能优化（压缩、缓存）
2. 设置 CI/CD 自动化部署
3. 文档完善
